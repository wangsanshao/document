### js事件循环

#### 宏任务
常见的宏任务有：
- 定时器
- DOM事件
- ajax请求
- js同步代码

#### 微任务
常见的微任务有：
- promise
- async/await
- 事件监听
- MutationObserver

#### 事件循环

- 执行全局代码：当javascript代码第一次运行时，首先会执行同步代码（相当于一次宏任务），如果遇到微任务就会把微任务放微任务队列，遇到宏任务放入宏任务队列。
- 检查微任务队列：一旦同步代码（宏任务）执行完成，事件循环会检查并执行微任务对列中的所有任务，直到对列为空。
- 执行下一个宏任务：如果微任务队列为空，事件循环会从宏任务队列中取出下一个任务并执行。
- 重复以上步骤：这个过程会不断循环，直到所有任务执行完毕。


#### 易错点

- promise本身是一个同步代码，至于偶后端面调用的then()方法里面的回调才是微任务
- await 右边的表达式还是会立即执行，表达式之后的代码才是微任务，await 微任务可以转换成等价的promise微任务分析
- script标签本身是一个宏任务，当有多个script标签时，浏览器会把script标签当做宏任务来处理

#### 示例代码

```javascript

console.log(1)
async function async1() {
    await async2()
    console.log(2)
    await async3()
    console.log(3)
}

async function async2() {
    console.log(4)
}

async function async3() {
    console.log(5)
}

async1()

setTimeout(function() {
    console.log(6)
}, 0)

new Promise(resolve => {
    console.log(7)
    resolve()
}).then(function() {
    console.log(8)
}).then(function() {
    console.log(9)
})
```
